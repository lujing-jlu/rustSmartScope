# SmartScope 调试功能说明

## 功能概述

在SmartScope项目的3D测量页面中添加了调试功能，可以查看和比较不同阶段的图像处理结果。

## 功能特性

### 1. 调试按钮
- 位置：3D测量页面的菜单栏
- 图标：设置图标
- 文字：调试

### 2. 调试页面布局
调试页面采用垂直布局设计，包含以下元素：

**页面结构：**
- **顶部标题** - "调试页面 - 图像处理结果"
- **图像显示区域** - 四个图像水平排列
- **底部按钮区域** - 返回按钮居中显示

**四个图像区域（从左到右）：**
1. **校正后的左图** - 立体校正后的左相机图像
2. **深度图** - 当前生成的深度图
3. **预测深度图** - AI模型预测的深度图
4. **校准后的预测深度图** - 经过校准的预测深度图

**布局特性：**
- 响应式设计，适应不同屏幕尺寸
- 图像区域有清晰的边框和背景
- 标题和按钮样式现代化
- 合理的间距和对齐

### 3. 导航功能
- 调试页面右上角有"返回3D测量"按钮
- 点击后可以返回到3D测量页面

## 使用方法

### 启动调试功能
1. 启动SmartScope应用程序
2. 进入3D测量页面
3. 点击菜单栏中的"调试"按钮
4. 系统会自动切换到调试页面

### 查看图像
- 四个图像区域会同时显示
- 深度图会自动转换为彩色显示（使用JET色彩映射）
- 图像会自动缩放以适应显示区域

### 返回3D测量
- 点击右上角的"返回3D测量"按钮
- 系统会返回到3D测量页面

## 技术实现

### 文件结构
```
include/app/ui/
├── debug_page.h          # 调试页面头文件
└── page_manager.h        # 页面管理器（已更新）

src/app/ui/
├── debug_page.cpp        # 调试页面实现
├── page_manager.cpp      # 页面管理器实现（已更新）
├── measurement_page.cpp  # 3D测量页面（已更新）
└── CMakeLists.txt        # 构建配置（已更新）
```

### 主要类
- `DebugPage`: 调试页面类，继承自`BasePage`
- `PageManager`: 页面管理器，负责页面切换
- `MeasurementPage`: 3D测量页面，包含调试按钮

### 关键功能
1. **图像显示**: 使用`ClickableImageLabel`显示图像
2. **深度图转换**: 将单通道深度图转换为彩色显示
3. **页面导航**: 通过`PageManager`实现页面切换
4. **图像传递**: 从3D测量页面传递图像数据到调试页面

## 编译说明

### 依赖项
- Qt 5.15+
- OpenCV 4.x
- CMake 3.18+

### 编译步骤
```bash
cd reference_code/SmartScope
make clean
make -j4
```

### 运行
```bash
./SmartScopeQt
```

## 测试

### 测试脚本
运行测试脚本生成测试图像：
```bash
python3 test_debug_feature.py
```

### 测试步骤
1. 启动SmartScope应用程序
2. 进入3D测量页面
3. 点击"调试"按钮
4. 验证调试页面显示
5. 测试返回功能

## 注意事项

1. **图像数据**: 目前调试页面显示的是3D测量页面中已有的图像数据
2. **预测深度图**: 预测深度图和校准后的预测深度图暂时为空，需要根据实际的AI推理结果进行填充
3. **性能**: 图像转换和显示可能会影响性能，建议在实际使用时进行优化
4. **内存**: 大量图像数据会占用较多内存，注意内存管理

## 扩展功能

### 可能的改进
1. **实时更新**: 支持实时更新调试图像
2. **图像保存**: 添加保存调试图像的功能
3. **参数调整**: 添加深度图显示参数的调整功能
4. **对比分析**: 添加图像对比分析工具
5. **性能监控**: 添加处理性能的监控显示

### 集成AI推理
要将实际的AI推理结果集成到调试页面，需要：
1. 在推理服务中添加回调函数
2. 将推理结果传递给调试页面
3. 实现预测深度图的校准算法
4. 添加推理性能监控

## 故障排除

### 常见问题
1. **编译错误**: 确保所有依赖项正确安装
2. **图像显示问题**: 检查OpenCV版本兼容性
3. **页面切换问题**: 检查PageManager的配置
4. **内存泄漏**: 确保正确释放图像资源

### 调试技巧
1. 查看日志输出
2. 使用Qt调试工具
3. 检查图像数据格式
4. 验证页面切换逻辑

## 版本历史

- v1.1: 修复布局问题
  - 重新设计页面布局结构
  - 采用垂直主布局 + 水平图像布局
  - 添加页面标题和底部按钮区域
  - 改进图像显示样式和间距
  - 优化响应式设计

- v1.0: 初始版本，实现基本的调试页面功能
  - 支持四种图像显示
  - 实现页面导航功能
  - 添加测试脚本和文档 