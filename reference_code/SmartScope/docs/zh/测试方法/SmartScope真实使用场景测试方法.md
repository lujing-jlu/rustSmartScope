# SmartScope 真实使用场景测试方法文档

## 📋 文档信息

- **文档版本**: v1.0
- **创建日期**: 2024-08-06
- **适用范围**: SmartScope 工业双目内窥镜系统
- **测试类型**: 真实使用场景功能测试
- **目标用户**: 测试工程师、质量保证人员

## 🎯 测试目标

通过模拟真实用户操作流程，验证SmartScope系统在实际使用场景下的功能正确性、测量精度和系统稳定性。

## 🧪 测试环境准备

### 硬件环境要求
- **主机**: RK3588 ARM64开发板
- **内存**: 8GB LPDDR4
- **存储**: 64GB eMMC + 256GB SSD
- **显示**: 1920x1080 IPS显示器
- **相机**: 双目USB 3.0相机（1280x720@30fps）

### 软件环境要求
- **操作系统**: Ubuntu 20.04 LTS ARM64
- **Qt版本**: 5.15.2
- **OpenCV版本**: 4.5.4
- **SmartScope版本**: 最新发布版本

### 标准测试样品

#### 1. 长度测量样品
- **标准游标卡尺**（精度0.02mm）
- **已知尺寸金属块**（20mm×30mm×10mm）
- **标准刻度尺**（精度1mm）

#### 2. 面积测量样品
- **标准正方形板**（50mm×50mm）
- **圆形标定板**（直径40mm）
- **不规则形状样品**（已知面积）

#### 3. 深度测量样品
- **阶梯状样品**（不同高度台阶）
- **凹槽样品**（已知深度）
- **平面样品**（用于平面测量）

#### 4. 立体视觉测试样品
- **棋盘格标定板**
- **纹理丰富的物体**
- **高对比度边缘样品**

## 📋 核心测试用例

### 5.3.1 相机功能测试用例

#### TC_CAM_001：相机设备发现测试

**测试目的**: 验证系统能够正确识别和连接双目相机设备

**操作流程**:
1. 启动SmartScope程序
2. 连接双目相机到USB端口
3. 观察程序界面中的相机状态显示
4. 检查相机参数设置界面
5. 验证左右相机图像显示

**验证指标**:
- ✅ 程序启动时间 ≤ 10秒
- ✅ 相机检测时间 ≤ 5秒
- ✅ 左右相机同时显示图像
- ✅ 图像清晰无花屏现象
- ✅ 帧率 ≥ 15fps

**成功标准**:
```
相机状态: 在线
左相机: 已连接 [图像预览正常]
右相机: 已连接 [图像预览正常]
帧率: 30fps
分辨率: 1280x720
```

**故障排除**:
- 如果检测不到相机：检查USB连接，重新插拔
- 如果图像花屏：检查USB带宽，尝试降低分辨率
- 如果程序崩溃：检查权限，使用 `sudo` 运行

---

#### TC_CAM_002：相机连接断开测试

**测试目的**: 验证系统在相机热插拔场景下的稳定性和自动恢复能力

**操作流程**:
1. 确保双目相机正常工作
2. 拔掉左相机USB连接
3. 观察程序响应和错误提示
4. 重新连接左相机
5. 验证自动重连功能
6. 重复测试右相机

**验证指标**:
- ✅ 断开检测时间 ≤ 2秒
- ✅ 错误提示显示时间 ≤ 1秒
- ✅ 重连时间 ≤ 10秒
- ✅ 重连成功率 ≥ 95%
- ✅ 重连后图像质量无下降

**成功标准**:
```
断开检测: 2秒内检测到断开
错误提示: "左相机连接断开，正在尝试重连..."
重连成功: 8秒内重新连接
图像质量: 重连前后无明显差异
```

**故障排除**:
- 如果断开检测延迟：检查USB驱动，更新固件
- 如果重连失败：检查USB端口，尝试其他端口
- 如果图像质量下降：检查USB带宽，关闭其他USB设备

---

#### TC_CAM_003：相机参数设置测试

**测试目的**: 验证相机参数调节功能的响应性和有效性

**操作流程**:
1. 进入相机参数设置界面
2. 调节曝光时间（1000-50000微秒）
3. 调节增益（1.0-16.0）
4. 调节亮度（-100到+100）
5. 调节对比度（-100到+100）
6. 保存参数设置
7. 重启程序验证参数持久化

**验证指标**:
- ✅ 参数调节响应时间 ≤ 2秒
- ✅ 参数调节效果明显可见
- ✅ 参数保存成功率 = 100%
- ✅ 参数持久化正确
- ✅ 参数范围限制有效

**成功标准**:
```
参数调节: 实时响应，效果明显
参数保存: 成功保存到配置文件
参数持久化: 重启后参数正确加载
参数范围: 在有效范围内调节
```

**故障排除**:
- 如果参数调节无效果：检查相机驱动，重启相机
- 如果参数保存失败：检查文件权限，确保可写
- 如果参数范围异常：检查相机固件，更新驱动

---

#### TC_CAM_004：双目同步测试

**测试目的**: 验证双目相机的时间戳同步精度和稳定性

**操作流程**:
1. 启动双目相机采集
2. 运行同步测试程序
3. 观察时间戳差异统计
4. 检查同步失败次数
5. 验证同步精度

**验证指标**:
- ✅ 时间戳差异 ≤ 5ms
- ✅ 同步成功率 ≥ 95%
- ✅ 同步失败次数 ≤ 5次/分钟
- ✅ 同步精度稳定

**成功标准**:
```
时间戳差异: 平均3.2ms，最大4.8ms
同步成功率: 97.5%
同步失败次数: 2次/分钟
同步精度: 稳定在±5ms范围内
```

**故障排除**:
- 如果同步差异过大：检查USB带宽，关闭其他设备
- 如果同步失败频繁：检查相机固件，更新驱动
- 如果同步不稳定：检查系统负载，关闭其他程序

---

#### TC_CAM_005：相机异常恢复测试

**测试目的**: 验证系统在相机异常情况下的处理能力和自动恢复机制

**操作流程**:
1. 模拟相机异常（如USB带宽不足）
2. 观察程序异常处理
3. 验证自动恢复机制
4. 检查错误日志记录
5. 测试手动恢复功能

**验证指标**:
- ✅ 异常检测时间 ≤ 3秒
- ✅ 自动恢复时间 ≤ 15秒
- ✅ 错误日志记录完整
- ✅ 手动恢复功能正常
- ✅ 系统稳定性无影响

**成功标准**:
```
异常检测: 3秒内检测到异常
自动恢复: 12秒内自动恢复
错误日志: 记录详细的错误信息
手动恢复: 手动恢复按钮功能正常
系统稳定性: 异常期间无崩溃
```

**故障排除**:
- 如果异常检测延迟：检查监控机制，优化检测逻辑
- 如果自动恢复失败：检查恢复策略，改进错误处理
- 如果系统崩溃：检查异常处理，增加防护机制

### 5.3.2 立体视觉测试用例

#### TC_STE_001：图像预处理测试

**测试目的**: 验证图像预处理功能的效果和质量

**操作流程**:
1. 使用标准棋盘格标定板
2. 调整相机位置和角度
3. 观察图像预处理效果
4. 检查图像质量指标
5. 验证预处理参数设置

**验证指标**:
- ✅ 图像清晰度良好
- ✅ 对比度适中
- ✅ 噪声水平低
- ✅ 预处理时间 ≤ 50ms

**成功标准**:
```
图像质量: 清晰度评分 ≥ 8.5/10
对比度: 适中，边缘清晰
噪声水平: 低噪声，无明显噪点
预处理时间: 45ms
```

**故障排除**:
- 如果图像质量差：调整相机参数，改善光照条件
- 如果预处理时间长：优化算法，减少处理步骤
- 如果噪声过多：调整滤波参数，改善图像质量

---

#### TC_STE_002：BM算法立体匹配测试

**测试目的**: 验证BM算法立体匹配的精度和性能

**操作流程**:
1. 选择BM算法进行立体匹配
2. 使用纹理丰富的测试样品
3. 调整BM算法参数
4. 观察视差图质量
5. 记录处理时间

**验证指标**:
- ✅ 视差图质量良好
- ✅ 匹配精度 ≥ 90%
- ✅ 处理时间 ≤ 200ms
- ✅ 参数调节有效

**成功标准**:
```
视差图质量: 边缘清晰，噪声少
匹配精度: 92.5%
处理时间: 180ms
参数调节: 参数变化效果明显
```

**故障排除**:
- 如果视差图质量差：调整算法参数，改善图像质量
- 如果匹配精度低：检查标定参数，重新标定
- 如果处理时间长：优化算法实现，减少计算量

---

#### TC_STE_003：SGBM算法立体匹配测试

**测试目的**: 验证SGBM算法立体匹配的精度和性能，与BM算法对比

**操作流程**:
1. 切换到SGBM算法
2. 使用相同测试样品
3. 调整SGBM算法参数
4. 对比BM和SGBM结果
5. 评估算法性能差异

**验证指标**:
- ✅ SGBM视差图质量优于BM
- ✅ 处理时间 ≤ 300ms
- ✅ 匹配精度 ≥ 95%
- ✅ 参数调节范围合理

**成功标准**:
```
SGBM质量: 优于BM算法
处理时间: 250ms
匹配精度: 96.8%
参数范围: 参数调节范围合理
```

**故障排除**:
- 如果SGBM质量不如BM：检查参数设置，调整算法配置
- 如果处理时间过长：优化算法实现，减少计算复杂度
- 如果精度不达标：检查输入图像质量，改善预处理

---

#### TC_STE_004：深度图生成测试

**测试目的**: 验证从视差图到深度图的转换精度和准确性

**操作流程**:
1. 使用已知深度的测试样品
2. 生成深度图
3. 测量深度图精度
4. 验证深度值范围
5. 检查深度图质量

**验证指标**:
- ✅ 深度图精度 ≥ 95%
- ✅ 深度值范围合理
- ✅ 深度图噪声低
- ✅ 生成时间 ≤ 500ms

**成功标准**:
```
深度精度: 96.2%
深度范围: 0.1m - 2.0m
深度图噪声: 低噪声水平
生成时间: 420ms
```

**故障排除**:
- 如果深度精度低：检查标定参数，重新标定相机
- 如果深度范围异常：检查相机参数，调整焦距
- 如果深度图噪声大：改善图像质量，调整滤波参数

---

#### TC_STE_005：算法性能对比测试

**测试目的**: 对比BM和SGBM算法的性能和效果差异

**操作流程**:
1. 使用标准测试场景
2. 分别运行BM和SGBM算法
3. 对比处理时间
4. 对比结果质量
5. 记录性能数据

**验证指标**:
- ✅ BM算法速度优于SGBM
- ✅ SGBM质量优于BM
- ✅ 性能差异在预期范围内
- ✅ 两种算法都稳定工作

**成功标准**:
```
BM处理时间: 180ms
SGBM处理时间: 250ms
BM质量评分: 8.5/10
SGBM质量评分: 9.2/10
性能差异: 符合预期
```

**故障排除**:
- 如果性能差异异常：检查算法实现，优化代码
- 如果质量差异不明显：使用更复杂的测试场景
- 如果算法不稳定：检查输入数据，改善图像质量

### 5.3.3 测量功能测试用例

#### TC_MEA_001：距离测量精度测试

**测试目的**: 验证长度测量功能的精度和准确性

**操作流程**:
1. 准备标准游标卡尺和已知尺寸样品
2. 在SmartScope中选择长度测量工具
3. 点击样品上的两个端点进行测量
4. 记录测量结果
5. 与标准值对比计算精度
6. 重复测量10次计算统计精度

**验证指标**:
- ✅ 测量精度 ≥ 95%
- ✅ 测量重复性 ≤ 2%
- ✅ 测量响应时间 ≤ 3秒
- ✅ 测量结果显示清晰

**成功标准**:
```
标准值: 20.00mm
测量值: 19.85mm, 20.12mm, 19.98mm...
平均精度: 96.8%
重复性: 1.2%
响应时间: 2.5秒
```

**故障排除**:
- 如果测量精度低：检查相机标定，重新标定
- 如果重复性差：改善图像质量，调整测量参数
- 如果响应时间长：优化算法，减少计算量

---

#### TC_MEA_002：面积测量精度测试

**测试目的**: 验证面积测量功能的精度和准确性

**操作流程**:
1. 准备标准正方形板（50mm×50mm）
2. 选择面积测量工具
3. 点击样品边界点形成闭合区域
4. 记录面积测量结果
5. 与标准面积对比计算精度
6. 测试不同形状样品

**验证指标**:
- ✅ 面积测量精度 ≥ 90%
- ✅ 闭合检测准确
- ✅ 面积计算正确
- ✅ 结果显示完整

**成功标准**:
```
标准面积: 2500mm²
测量面积: 2420mm²
测量精度: 96.8%
闭合检测: 准确检测到闭合
计算正确: 面积计算公式正确
```

**故障排除**:
- 如果面积精度低：检查深度图质量，改善立体匹配
- 如果闭合检测失败：调整闭合阈值，改善用户交互
- 如果计算错误：检查计算公式，验证算法实现

---

#### TC_MEA_003：角度测量精度测试

**测试目的**: 验证角度测量功能的精度和准确性

**操作流程**:
1. 准备已知角度的测试样品
2. 选择角度测量工具
3. 点击三个点定义角度
4. 记录角度测量结果
5. 与标准角度对比
6. 测试不同角度范围

**验证指标**:
- ✅ 角度测量精度 ≥ 95%
- ✅ 角度范围支持0-180度
- ✅ 测量响应及时
- ✅ 结果显示准确

**成功标准**:
```
标准角度: 90°
测量角度: 89.5°
测量精度: 99.4%
角度范围: 支持0-180度
响应时间: 2.8秒
```

**故障排除**:
- 如果角度精度低：检查3D坐标计算，改善深度精度
- 如果角度范围异常：检查角度计算，验证数学公式
- 如果响应延迟：优化算法，减少计算时间

---

#### TC_MEA_004：测量工具交互测试

**测试目的**: 验证测量工具的用户交互体验和功能完整性

**操作流程**:
1. 测试所有测量工具切换
2. 验证工具选择响应
3. 测试测量点添加和删除
4. 验证测量结果显示
5. 测试测量历史记录
6. 验证测量结果导出

**验证指标**:
- ✅ 工具切换响应时间 ≤ 1秒
- ✅ 测量点操作流畅
- ✅ 结果显示及时
- ✅ 历史记录完整
- ✅ 导出功能正常

**成功标准**:
```
工具切换: 0.8秒内完成切换
测量点操作: 流畅，无卡顿
结果显示: 实时显示测量结果
历史记录: 完整保存测量历史
导出功能: 成功导出测量报告
```

**故障排除**:
- 如果工具切换慢：优化UI响应，减少界面更新
- 如果操作不流畅：改善用户交互，优化响应机制
- 如果导出失败：检查文件权限，验证导出格式

---

#### TC_MEA_005：测量结果保存测试

**测试目的**: 验证测量结果的保存、恢复和导出功能

**操作流程**:
1. 完成多个测量任务
2. 保存测量结果
3. 关闭程序
4. 重新启动程序
5. 验证测量结果恢复
6. 测试结果导出功能

**验证指标**:
- ✅ 保存成功率 = 100%
- ✅ 数据完整性保持
- ✅ 恢复时间 ≤ 5秒
- ✅ 导出格式正确

**成功标准**:
```
保存成功率: 100%
数据完整性: 所有数据完整保存
恢复时间: 3.2秒
导出格式: JSON格式正确
数据量: 支持大量测量数据
```

**故障排除**:
- 如果保存失败：检查文件权限，确保存储空间充足
- 如果数据丢失：检查保存机制，改进错误处理
- 如果恢复慢：优化数据加载，减少读取时间

## 📊 测试结果评估

### 测试报告模板

```
SmartScope 真实使用场景测试报告
================================

测试信息:
- 测试时间: 2024-08-06 14:30:00 - 2024-08-06 16:45:00
- 测试环境: RK3588开发板，Ubuntu 20.04
- 测试人员: 测试工程师
- 测试版本: SmartScope v1.0

测试结果汇总:
- 相机功能测试: 5/5 通过
- 立体视觉测试: 5/5 通过  
- 测量功能测试: 5/5 通过
- 总体通过率: 100%

详细结果:

1. 相机功能测试
   - TC_CAM_001: 通过 (相机检测时间: 3.2秒)
   - TC_CAM_002: 通过 (重连成功率: 97.5%)
   - TC_CAM_003: 通过 (参数调节响应: 1.8秒)
   - TC_CAM_004: 通过 (同步精度: 3.2ms)
   - TC_CAM_005: 通过 (异常恢复时间: 12秒)

2. 立体视觉测试
   - TC_STE_001: 通过 (图像质量评分: 8.8/10)
   - TC_STE_002: 通过 (BM算法精度: 92.5%)
   - TC_STE_003: 通过 (SGBM算法精度: 96.8%)
   - TC_STE_004: 通过 (深度图精度: 96.2%)
   - TC_STE_005: 通过 (性能对比符合预期)

3. 测量功能测试
   - TC_MEA_001: 通过 (距离测量精度: 96.8%)
   - TC_MEA_002: 通过 (面积测量精度: 96.8%)
   - TC_MEA_003: 通过 (角度测量精度: 99.4%)
   - TC_MEA_004: 通过 (交互响应时间: 0.8秒)
   - TC_MEA_005: 通过 (数据保存成功率: 100%)

性能指标:
- 平均响应时间: 2.3秒
- 平均测量精度: 97.7%
- 系统稳定性: 优秀
- 用户体验: 良好

问题记录:
- 无重大问题
- 轻微优化建议: 可进一步优化UI响应速度

结论: 系统在真实使用场景下表现良好，各项功能正常，测量精度满足要求。
建议: 可以进入下一阶段测试或正式发布。
```

### 测试结果判断标准

#### 通过标准
- **功能测试**: 所有测试用例必须通过
- **性能测试**: 响应时间、精度等指标达到要求
- **稳定性测试**: 无崩溃、无严重错误
- **用户体验**: 操作流畅、界面友好

#### 失败标准
- **功能失效**: 核心功能无法正常工作
- **性能不达标**: 响应时间或精度超出阈值
- **系统崩溃**: 程序运行过程中发生崩溃
- **数据丢失**: 测量数据保存或恢复失败

## 🎯 测试执行建议

### 1. 测试环境准备
- **硬件检查**: 确保所有硬件设备正常工作
- **软件准备**: 安装最新版本的SmartScope
- **样品准备**: 准备标准测试样品和工具
- **环境设置**: 确保测试环境光线充足、稳定

### 2. 操作流程标准化
- **严格按照操作步骤执行**: 避免人为误差
- **记录详细数据**: 包括时间、数值、状态等
- **保持环境稳定**: 避免测试过程中环境变化
- **及时记录问题**: 发现问题时立即记录

### 3. 数据记录完整
- **测试数据**: 记录所有测试数据和结果
- **性能指标**: 记录响应时间、精度等指标
- **问题记录**: 详细记录发现的问题和现象
- **改进建议**: 记录优化建议和改进方向

### 4. 问题及时反馈
- **问题分类**: 按严重程度分类问题
- **详细描述**: 提供问题的详细描述和复现步骤
- **及时反馈**: 发现问题时立即反馈给开发团队
- **跟踪解决**: 跟踪问题的解决进度

### 5. 持续改进
- **定期回顾**: 定期回顾测试结果和问题
- **流程优化**: 根据测试结果优化测试流程
- **标准更新**: 根据实际情况更新测试标准
- **工具改进**: 持续改进测试工具和方法

## 🔧 故障排除指南

### 常见问题及解决方案

#### 相机相关问题
1. **相机无法检测**
   - 检查USB连接是否牢固
   - 重新插拔USB线缆
   - 检查USB驱动是否正确安装
   - 尝试其他USB端口

2. **图像质量差**
   - 调整相机参数（曝光、增益等）
   - 改善环境光照条件
   - 清洁相机镜头
   - 检查相机固件版本

3. **同步精度差**
   - 检查USB带宽是否充足
   - 关闭其他USB设备
   - 更新相机驱动
   - 调整同步参数

#### 测量相关问题
1. **测量精度低**
   - 重新进行相机标定
   - 改善图像质量
   - 调整测量参数
   - 检查测试样品是否标准

2. **测量响应慢**
   - 优化算法实现
   - 减少图像分辨率
   - 关闭不必要的功能
   - 检查系统资源使用

3. **测量结果异常**
   - 检查深度图质量
   - 验证3D坐标计算
   - 检查测量算法
   - 重新进行系统标定

#### 系统相关问题
1. **程序崩溃**
   - 检查内存使用情况
   - 更新系统驱动
   - 检查程序日志
   - 重新安装程序

2. **性能下降**
   - 关闭其他程序
   - 检查系统资源
   - 优化程序配置
   - 升级硬件配置

3. **数据丢失**
   - 检查存储空间
   - 验证文件权限
   - 检查保存机制
   - 改进错误处理

## 📝 文档维护

### 版本历史
- **v1.0** (2024-08-06): 初始版本，包含完整的测试用例和流程

### 更新计划
- 根据测试结果持续优化测试用例
- 根据用户反馈改进测试流程
- 根据系统更新调整验证指标
- 定期更新故障排除指南

### 联系方式
- **测试团队**: 负责测试执行和结果分析
- **开发团队**: 负责问题修复和功能改进
- **质量保证**: 负责测试质量监督和标准制定

---

**文档结束**

*本文档为SmartScope工业双目内窥镜系统的真实使用场景测试方法，请严格按照文档要求执行测试，确保系统质量和用户体验。* 