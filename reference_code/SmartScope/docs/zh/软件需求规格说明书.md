# SmartScope 工业双目内窥镜系统 - 软件需求规格说明书

## 1. 引言

### 1.1 编写目的
本文档旨在详细描述 SmartScope 工业双目内窥镜系统的软件需求，为系统设计、开发、测试和验收提供依据。本文档面向项目开发团队、测试团队、项目管理人员和最终用户。

### 1.2 项目背景
SmartScope 是一个基于双目立体视觉技术的工业内窥镜检测系统，主要用于工业设备内部缺陷检测、质量控制和维护检查。系统通过双目相机获取立体图像，利用计算机视觉和深度学习技术实现三维重建、缺陷识别和精确测量。

### 1.3 定义和缩略语
- **双目立体视觉**：使用两个相机模拟人眼视觉，获取物体的三维信息
- **视差图**：表示左右图像对应点深度差异的图像
- **点云**：三维空间中点的集合，用于表示物体的三维形状
- **ONNX**：开放神经网络交换格式
- **RKNN**：瑞芯微神经网络推理框架
- **PCL**：点云库 (Point Cloud Library)

### 1.4 参考资料
- IEEE Std 830-1998 软件需求规格说明推荐实践
- ISO/IEC 25010:2011 系统和软件质量模型
- OpenCV 4.5+ 文档
- Qt 5.15+ 文档

## 2. 项目概述

### 2.1 产品概述
SmartScope 工业双目内窥镜系统是一个集成了图像采集、立体视觉处理、深度学习推理和三维测量功能的综合性工业检测平台。系统支持实时双目图像采集、自动立体匹配、三维重建、缺陷检测和精确测量。

### 2.2 产品功能
- 双目相机实时图像采集和同步
- 相机参数自动/手动调节
- 立体匹配和深度计算
- 三维点云重建和可视化
- 基于深度学习的缺陷检测
- 精确的三维测量工具
- 检测结果注释和报告生成
- 数据管理和文件浏览

### 2.3 用户特点
- **主要用户**：工业检测工程师、质量控制人员
- **技能水平**：具备基本的计算机操作技能和工业检测经验
- **使用环境**：工业生产线、实验室、维修车间
- **使用频率**：每日多次使用，单次使用时长 30 分钟至数小时

### 2.4 约束条件
- 硬件平台：RK3588 ARM64 处理器
- 操作系统：Linux (Ubuntu 20.04+)
- 相机接口：USB 3.0
- 显示分辨率：最低 1920x1080
- 运行环境：工业环境，温度 0-50°C，湿度 10-90%

## 3. 功能需求

### 3.1 相机管理功能 (F001)

#### 3.1.1 相机设备管理 (F001.1)
**需求描述**：系统应能够自动发现、连接和管理双目相机设备。

**功能要求**：
- 自动检测 USB 相机设备
- 支持多相机同时连接
- 相机热插拔检测
- 相机状态实时监控
- 相机设备信息显示（型号、分辨率、帧率等）

**输入**：USB 相机设备连接
**输出**：相机设备列表、连接状态
**优先级**：高

#### 3.1.2 相机参数控制 (F001.2)
**需求描述**：系统应提供相机参数的精细调节功能。

**功能要求**：
- 曝光时间调节（1-100000 微秒）
- 增益调节（1.0-16.0）
- 白平衡调节（自动/手动）
- 亮度、对比度、饱和度调节
- 分辨率设置（支持 640x480 到 1920x1080）
- 帧率设置（1-60 FPS）
- 参数预设保存和加载
- 参数调节历史记录

**输入**：用户参数调节操作
**输出**：实时图像效果预览
**优先级**：高

#### 3.1.3 双目相机同步 (F001.3)
**需求描述**：系统应实现双目相机的精确同步采集。

**功能要求**：
- 硬件时间戳同步（精度 ≤ 1ms）
- 同步阈值可配置（10-100ms）
- 同步失败检测和恢复
- 同步质量监控和统计
- 支持低延迟和高精度两种同步模式

**输入**：双目相机图像流
**输出**：同步的左右图像对
**优先级**：高

### 3.2 立体视觉处理功能 (F002)

#### 3.2.1 图像预处理 (F002.1)
**需求描述**：系统应对采集的图像进行预处理以提高立体匹配质量。

**功能要求**：
- 图像去噪（高斯滤波、双边滤波）
- 图像增强（直方图均衡化、对比度增强）
- 图像校正（畸变校正、立体校正）
- 图像格式转换
- 预处理参数可调节

**输入**：原始双目图像
**输出**：预处理后的双目图像
**优先级**：中

#### 3.2.2 立体匹配 (F002.2)
**需求描述**：系统应支持多种立体匹配算法进行视差计算。

**功能要求**：
- BM (Block Matching) 算法
- SGBM (Semi-Global Block Matching) 算法
- 基于深度学习的立体匹配
- 算法参数可调节
- 算法性能对比
- 实时处理能力（≥ 10 FPS）

**输入**：预处理后的双目图像
**输出**：视差图
**优先级**：高

#### 3.2.3 深度图生成 (F002.3)
**需求描述**：系统应将视差图转换为深度图并进行后处理。

**功能要求**：
- 视差到深度的转换
- 深度图滤波（中值滤波、双边滤波）
- 空洞填充
- 深度范围限制
- 深度精度优化

**输入**：视差图、相机标定参数
**输出**：深度图
**优先级**：高

### 3.3 三维重建功能 (F003)

#### 3.3.1 点云生成 (F003.1)
**需求描述**：系统应根据深度图和彩色图像生成三维点云。

**功能要求**：
- 深度图到点云的转换
- 彩色信息映射
- 点云密度控制
- 坐标系变换
- 点云质量评估

**输入**：深度图、彩色图像、相机参数
**输出**：彩色点云数据
**优先级**：高

#### 3.3.2 点云处理 (F003.2)
**需求描述**：系统应提供点云的滤波、优化和处理功能。

**功能要求**：
- 体素网格滤波（降采样）
- 统计离群点移除
- 半径滤波
- 平面拟合和优化
- 点云配准
- 点云分割

**输入**：原始点云数据
**输出**：处理后的点云数据
**优先级**：中

#### 3.3.3 三维可视化 (F003.3)
**需求描述**：系统应提供三维点云和模型的可视化功能。

**功能要求**：
- 点云实时渲染
- 视角控制（旋转、缩放、平移）
- 颜色映射（深度、强度、RGB）
- 点大小调节
- 背景设置
- 坐标轴显示
- 截图和录制功能

**输入**：点云数据
**输出**：三维可视化界面
**优先级**：中

### 3.4 深度学习推理功能 (F004)

#### 3.4.1 模型管理 (F004.1)
**需求描述**：系统应支持深度学习模型的加载和管理。

**功能要求**：
- ONNX 模型加载
- RKNN 模型加载
- 模型信息显示
- 模型切换
- 模型性能监控

**输入**：模型文件路径
**输出**：加载状态、模型信息
**优先级**：中

#### 3.4.2 推理处理 (F004.2)
**需求描述**：系统应提供高效的深度学习推理服务。

**功能要求**：
- 异步推理处理
- 批量推理支持
- 硬件加速（CPU/GPU/NPU）
- 推理队列管理
- 推理结果缓存
- 性能模式切换（速度/平衡/质量）

**输入**：双目图像、推理参数
**输出**：推理结果（视差图、检测结果等）
**优先级**：中

### 3.5 测量功能 (F005)

#### 3.5.1 距离测量 (F005.1)
**需求描述**：系统应支持三维空间中的距离测量。

**功能要求**：
- 点到点距离测量
- 多点折线距离测量
- 测量精度显示
- 测量单位切换（mm/cm/m）
- 测量结果保存
- 测量历史记录

**输入**：用户点击操作、点云数据
**输出**：距离测量结果
**优先级**：高

#### 3.5.2 面积测量 (F005.2)
**需求描述**：系统应支持三维表面的面积测量。

**功能要求**：
- 多边形面积测量
- 曲面面积测量
- 面积计算算法优化
- 测量精度评估
- 结果可视化

**输入**：用户选择区域、点云数据
**输出**：面积测量结果
**优先级**：中

#### 3.5.3 角度测量 (F005.3)
**需求描述**：系统应支持三维空间中的角度测量。

**功能要求**：
- 三点角度测量
- 平面夹角测量
- 角度单位切换（度/弧度）
- 角度可视化显示

**输入**：用户选择点/平面、点云数据
**输出**：角度测量结果
**优先级**：中

### 3.6 用户界面功能 (F006)

#### 3.6.1 主界面 (F006.1)
**需求描述**：系统应提供直观、易用的主界面。

**功能要求**：
- 实时双目图像显示
- 工具栏和菜单栏
- 状态栏信息显示
- 多页面管理
- 快捷键支持
- 界面主题切换

**输入**：用户操作
**输出**：界面响应
**优先级**：高

#### 3.6.2 参数控制面板 (F006.2)
**需求描述**：系统应提供参数调节的控制面板。

**功能要求**：
- 相机参数调节界面
- 算法参数调节界面
- 实时参数效果预览
- 参数重置功能
- 参数导入导出

**输入**：用户参数调节
**输出**：参数值更新、效果预览
**优先级**：中

### 3.7 数据管理功能 (F007)

#### 3.7.1 文件管理 (F007.1)
**需求描述**：系统应提供完整的文件管理功能。

**功能要求**：
- 图像文件保存（JPG、PNG、BMP、TIFF）
- 点云文件保存（PLY、OBJ、PCD）
- 视频录制（MP4、AVI）
- 文件浏览和预览
- 文件批量操作
- 文件元数据管理
- 存储空间监控

**输入**：用户文件操作
**输出**：文件保存/加载结果
**优先级**：中

#### 3.7.2 数据导入导出 (F007.2)
**需求描述**：系统应支持多种格式的数据导入导出。

**功能要求**：
- 标定数据导入导出
- 测量结果导出（CSV、Excel）
- 配置文件导入导出
- 报告导出（PDF、HTML、DOCX）
- 数据格式转换

**输入**：数据文件、导出参数
**输出**：转换后的数据文件
**优先级**：中

### 3.8 系统配置功能 (F008)

#### 3.8.1 系统设置 (F008.1)
**需求描述**：系统应提供全面的系统配置功能。

**功能要求**：
- 语言设置（中文/英文）
- 界面主题设置
- 日志级别配置
- 性能模式设置
- 硬件加速配置
- 网络设置
- 自动更新设置

**输入**：用户配置操作
**输出**：配置更新确认
**优先级**：低

#### 3.8.2 用户管理 (F008.2)
**需求描述**：系统应支持多用户管理和权限控制。

**功能要求**：
- 用户账户管理
- 权限级别设置
- 操作日志记录
- 用户配置隔离
- 密码安全策略

**输入**：管理员操作
**输出**：用户管理结果
**优先级**：低

## 4. 非功能需求

### 4.1 性能需求

#### 4.1.1 响应时间
- 图像采集延迟：≤ 100ms
- 立体匹配处理：≤ 200ms（1280x720 分辨率）
- 界面响应时间：≤ 100ms
- 系统启动时间：≤ 30s

#### 4.1.2 吞吐量
- 图像采集帧率：≥ 30 FPS
- 立体匹配处理：≥ 10 FPS
- 点云生成：≥ 5 FPS
- 并发用户数：≥ 1（单机版）

#### 4.1.3 资源使用
- CPU 使用率：≤ 80%（正常工作负载）
- 内存使用：≤ 4GB
- 存储空间：≤ 16GB（系统安装）
- 网络带宽：≤ 100Mbps（数据传输）

### 4.2 可靠性需求

#### 4.2.1 可用性
- 系统可用性：≥ 99%
- 平均故障间隔时间（MTBF）：≥ 720 小时
- 平均修复时间（MTTR）：≤ 4 小时

#### 4.2.2 容错性
- 相机连接异常自动恢复
- 内存不足时优雅降级
- 网络中断时本地功能正常
- 异常情况下数据完整性保护

#### 4.2.3 数据完整性
- 图像数据校验和验证
- 配置文件备份和恢复
- 测量数据一致性检查
- 系统状态持久化

### 4.3 安全性需求

#### 4.3.1 数据安全
- 敏感数据加密存储
- 用户权限访问控制
- 操作审计日志
- 数据备份和恢复

#### 4.3.2 系统安全
- 输入数据验证
- 缓冲区溢出防护
- 恶意代码防护
- 安全更新机制

### 4.4 可用性需求

#### 4.4.1 易用性
- 用户界面直观友好
- 操作流程简单明确
- 错误信息清晰易懂
- 在线帮助和文档

#### 4.4.2 学习性
- 新用户上手时间：≤ 2 小时
- 完整功能掌握时间：≤ 8 小时
- 提供操作教程和示例
- 支持操作录制和回放

### 4.5 兼容性需求

#### 4.5.1 硬件兼容性
- 支持 RK3588 ARM64 平台
- 兼容主流 USB 3.0 相机
- 支持多种显示器分辨率
- 兼容标准输入设备

#### 4.5.2 软件兼容性
- Linux 内核版本：≥ 4.19
- Qt 版本：≥ 5.15
- OpenCV 版本：≥ 4.5
- 文件格式向后兼容

### 4.6 可维护性需求

#### 4.6.1 可修改性
- 模块化设计，低耦合
- 配置文件外部化
- 插件式架构支持
- 代码注释覆盖率：≥ 80%

#### 4.6.2 可测试性
- 单元测试覆盖率：≥ 90%
- 集成测试覆盖率：≥ 80%
- 自动化测试支持
- 性能测试工具集成

## 5. 约束条件

### 5.1 技术约束
- 必须使用 C++17 标准
- 必须基于 Qt 5.15+ 框架
- 必须支持 OpenCV 4.5+
- 必须运行在 Linux 系统上

### 5.2 硬件约束
- 目标平台：RK3588 ARM64
- 最小内存：4GB RAM
- 最小存储：16GB
- 相机接口：USB 3.0

### 5.3 法律约束
- 遵守开源软件许可证
- 符合工业安全标准
- 满足数据保护法规
- 知识产权合规

### 5.4 商业约束
- 开发周期：6 个月
- 开发预算：有限
- 团队规模：5-8 人
- 维护期：3 年

## 6. 验收标准

### 6.1 功能验收
- 所有高优先级功能完全实现
- 中优先级功能实现率：≥ 90%
- 低优先级功能实现率：≥ 70%
- 功能测试通过率：≥ 95%

### 6.2 性能验收
- 满足所有性能需求指标
- 压力测试通过
- 长时间运行稳定性测试通过
- 资源使用符合要求

### 6.3 质量验收
- 代码质量评审通过
- 安全测试通过
- 用户体验测试通过
- 文档完整性检查通过

## 7. 附录

### 7.1 术语表
- **立体匹配**：在左右图像中寻找对应点的过程
- **视差**：左右图像中对应点的水平位置差
- **点云**：三维空间中点的集合
- **标定**：确定相机内外参数的过程

### 7.2 参考文档
- 系统架构设计文档
- 用户界面设计规范
- 数据库设计文档
- 测试计划文档

### 7.3 变更记录
| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 1.0 | 2024-08-04 | 初始版本 | 开发团队 |
